## st-asc



##### Fork of the st terminal. (suckless.org)

Slim version with performance and memory footprint related modifications.
 
___   

	Stripped unicode support and rgb colors.
		utf8 is an optional compiletime switch now

	Delayed allocation of the history buffer. 
		Saves up to tenths or even hundreds of MB, 
		depending on the terminal's width and history size

	A few minor optimizations.

	Nicer cursor and configurable cursorcolor for unfocused windows.
	No scrollback "behind" the current history anymore.

Please see [LOG.md](LOG.md) for more detailed info.
___

Applied Patches:

<img align="right" src="images/vt-102-1984.jpg"> 

- anysize
- clipboard
- keyboard_select
- relative_border
- scrollback
- scrollback-mouse
- scrollback-mouse-increment
- selectioncolors
- xresources <br>
		added commandline switch -x to enable reading the xresources,<br>
		compile time switch "XRESOURCES"


### Requirements

- Xlib headers
- Xft headers


### Install

Edit Makefile <br>
Edit config.h.in
```
make
make install
```

---

### About


(A screenshot of i3 and 3 instances of st-asc)

![screenshot](images/st-asc_with_i3.png)


Unicode encoding needs 4 Bytes per char within st,
and I nearly never need unicode chars in the terminal.

Same for rgb colors. Stripping them of st spares 6 Bytes per Glyph.

Before the changes every Glyph needed 15 Bytes,
now it's 4 Bytes. I personally prefer having a quite big (10.000 lines or more)
scrollback buffer, so this is a factor.
Resulting in a faster and more responsive terminal emulation.



>(..I'd propose, unicode isn't needed for system administration/
development at all. You are going to get into all sort of troubles,
when, e.g., you'd be naming files and directories in the root fs
using unicode characters. Furthermore, let's assume, there are, say,
100.000 instances of st running. Now, on the world. Multiply this
with, umm, 10 MB, multiply with cpu cycles of 100.000 (swapping, and so on),
and . It's not theorethical anymore. Ok. The calculation might be a little bit wrong,
Admittedly, you shouldn't multiply memory and cpu cycles.
Anyways, my point is valid. And there is the computing time to add,
generated by typos. Adding a unicode character in the wrong script could create.. uuh
never mind. But it's a good reason to stick to KISS (keep it simple, stupid..) principles. 
Murphy's law will strike, anyways. That's the law..)


So, in my quest to slim down all programs I'm using,
I'm about to strip unicode and utf8 support.

Yet I managed to get a memory footprint of around 8MB.
Ok. Added all patches, and with the current history of 10k lines,
it's at 12MB.
(>20MB before)
I'm always keeping more than 10 terminals open,
so that sums up. What now has two meanings. 
I have to look for what exactly blows that much.
Every Glyph (char at the screen, with attributes and colors) now
needs 4 Bytes. ( around 16Bytes before stripping unicode and rgb)


The smaller memory footprint also pays out in a more responsive
system overall, improving st's speed as well. (3x here) Ok.
I tried hard, to get "benchmarks", the removed unicode support
doesn't profit of. Still, this shows up with a gain of 2x.

I checked several emulators, closest in terms of performance would be 
urxvt. However, testing and comparing more, the speed of urxvt is given
by a (neat) trick. When dumping many chars into the terminal, eg. with cat,
the screen doesn't show every single character. It's more sort of an animation,
showing only enough chars to give the perception of a continous scrolling
terminal. When confronted with, e.g., a `dd if=data bs=1000`;
this cheat doesn't work anymore, dumping the data takes (depending on the size, etc)
up to 20times longer. 
So st seems to be the fastest terminal emulator available. 




It's however a crude hack, much (unused) utf8 supporting code is left yet.
Hopefully the compiler does it's job eliminating unneeded potions.

The rgb color support is stripped.
Saving 6 Bytes per glyph.
Oh. I see. There still is the option to
have "rgb" colors via modifying the indexed 256 color palette.
I just slimmed down the memory usage for the colors from 8 Bytes to 2 Bytes per glyph.


;) To quote Bill, 256 colors might be enough for everyone.
(Am I confusing something..?..)

![](images/colors.png?raw=true)

"256" colors (with attributes faint, normal, bold) and the ascii table without control characters as displayed by st-asc.<br>
The scripts for creating the output are within ./test

![](images/ascii.png)


### Links

About utf8 
http://doc.cat-v.org/bell_labs/utf-8_history

A comparison on latency, speed and memory consumption of
different terminal emulators. st and urxvt standing out.
So my feelings on st being suitable as base for a slimmed down terminal emulator
have been right.
https://anarc.at/blog/2018-05-04-terminal-emulators-2/

Latency. https://danluu.com/term-latency/

Latency, comparing old (1980) and nowadays systems.
https://danluu.com/input-lag/



### Bugs

Clipboard copy/paste of characters > 127 currently doesn't communicate correctly
with Xorg programs. 


(unconfirmed)
* fix shift up/down (shift selection in emacs)
* remove DEC test sequence when appropriate



---- snip ----

### roadmap


<img align="right" src="images/noticket.jpg"> 

- strip ~~unicode~~ (done mostly)
- ~~strip rgb colors~~
- ~~add patches~~
- Compression of history buffer
- wayland? postponed.
- gain earth domination
- quench vogons
- stifle laughter
- stop being childish
___

- ~~Store fonts in either the shared library,<br>
  or use the core Xorg interface / freetype2 ?~~
	_(https://en.wikibooks.org/wiki/Guide_to_X11/Fonts)
	uuuh. that's a whole bunch of wasps. Better leave 
  the working system as it is. Resource saving might also be possible
	by the separation into libstasc.so and st-asc
	Probably with the drawback of having only one font available,
	without having to dig to much into the internals of library loading_
- ~~separation into a shared library and st-asc~~
	Doesn't give much gain.
	I leave the option for compiling st as shared library within the makefile
	But you'd have to install the shared lib yourself (with ldconfig on linux)

xxxx
**---- SNIP -----**

(misc 2020, misc.myer@zoho.com )


====================



Credits
-------

Based on Aurelien APTEL <aurelien dot aptel at gmail dot com> bt source code.

Fetched from the suckless git repo (suckless.org) on 2020/01/01.

All authors of the several patches.


